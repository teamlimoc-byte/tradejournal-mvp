<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trading Platform MVP ‚Äî Pre-Trade Checklist</title>
  <link rel="stylesheet" href="./assets/styles.css?v=20260301m6" />
</head>
<body class="checklist-page">
  <header class="topbar">
    <div class="container">
      <div class="brand">Trade<span>Journal</span> MVP</div>
      <nav class="nav">
        <a class="nav-link" href="index.html">Combined</a>
        <a class="nav-link" href="dashboard-futures.html">Futures</a>
        <a class="nav-link" href="dashboard-options.html">Options</a>
        <a class="nav-link" href="checklist.html">Checklist</a>
        <a class="nav-link" href="trades.html">Trades</a>
        <a class="nav-link" href="journal.html">Journal</a>
        <a class="nav-link" href="reports.html">Reports</a>
        <button id="theme-toggle" class="btn" type="button" style="padding:7px 10px;">üåô</button>
      </nav>
    </div>
  </header>

  <main class="container">
    <h1 class="page-title">Pre-Trade Checklist</h1>
    <div class="subtle">Run this before entry. Score and grade are saved into new trade records automatically.</div>
    <section id="checklist-root" style="margin-top:12px;"></section>
  </main>

  <footer>Static/offline-friendly build for GitHub Pages</footer>
  <script src="./assets/app.js?v=20260301m6"></script>
  <script>
    (function(){
      const key = 'mvp_pretrade_checklist_v1';
      const root = document.getElementById('checklist-root');
      if (!root) return;
      if (root.innerHTML && root.innerHTML.trim().length) return;

      const def = {
        date: new Date().toISOString().slice(0,10), time:'', direction:'Long',
        mtfAligned:'', biasAligned:'', aPlusWindow:'', bosConfirmed:'', orbCondition:'',
        clearPath:'', waitOneMin:'', emotionCheck:'', notes:''
      };
      const load = () => { try { return Object.assign({}, def, JSON.parse(localStorage.getItem(key)||'{}')); } catch { return Object.assign({}, def); } };
      const save = (d) => localStorage.setItem(key, JSON.stringify(d));
      const score = (d) => {
        const fields = ['mtfAligned','biasAligned','aPlusWindow','bosConfirmed','orbCondition','clearPath','waitOneMin','emotionCheck'];
        const yes = fields.filter(f => String(d[f]).toLowerCase()==='yes').length;
        const critical = ['mtfAligned','biasAligned','aPlusWindow','emotionCheck'];
        const criticalOk = critical.every(f => String(d[f]).toLowerCase()==='yes');
        const grade = (criticalOk && yes>=7) ? 'A+' : (criticalOk && yes>=5) ? 'B' : 'NO TRADE';
        return {yes,total:fields.length,grade};
      };

      function nowHHMM(){ const n = new Date(); return String(n.getHours()).padStart(2,'0') + ':' + String(n.getMinutes()).padStart(2,'0'); }
      function render(){
        const d = load();
        const s = score(d);
        const yn = (name,label) => {
          const yesOn = d[name] === 'yes';
          const noOn = d[name] === 'no';
          return `<div class="field"><label>${label}</label><div style="display:flex; gap:8px; margin-top:6px;"><button type="button" class="btn yn-btn yn-yes ${yesOn?'active':''}" data-field="${name}" data-val="yes">${yesOn?'‚úì ':''}Yes</button><button type="button" class="btn yn-btn yn-no ${noOn?'active':''}" data-field="${name}" data-val="no">${noOn?'‚úì ':''}No</button></div></div>`;
        };
        const now = new Date();
        const autoDate = d.date || now.toISOString().slice(0,10);
        const autoTime = d.time || nowHHMM();
        const noTradeBanner = s.grade === 'NO TRADE'
          ? `<div style="margin-bottom:10px; padding:10px 12px; border:1px solid rgba(239,68,68,.45); background:rgba(239,68,68,.12); color:#fecaca; border-radius:10px; font-weight:700;">‚õî NO TRADE ‚Äî Checklist conditions not met. Stand down and wait for A+ setup.</div>`
          : '';

        root.innerHTML = `
          <div class="panel">
            ${noTradeBanner}
            <div class="toolbar" style="grid-template-columns: minmax(0,.8fr) minmax(0,1.2fr);">
              <div class="field"><label>Date (auto)</label><input type="date" name="date" value="${autoDate}" /></div>
              <div class="field"><label>Direction</label><select name="direction"><option ${d.direction==='Long'?'selected':''}>Long</option><option ${d.direction==='Short'?'selected':''}>Short</option></select></div>
            </div>
            <div class="toolbar" style="grid-template-columns: repeat(2,minmax(0,1fr)); margin-top:10px;">
              ${yn('mtfAligned','3/4 MTF ALIGNED?')}
              ${yn('biasAligned','BIAS MATCHED?')}
              ${yn('aPlusWindow','A+ WINDOW?')}
              ${yn('bosConfirmed','BOS CONFIRMED?')}
              ${yn('orbCondition','ORB CONDITION MET?')}
              ${yn('clearPath','CLEAR PATH TO TARGET?')}
              ${yn('waitOneMin','‚úÖ WAITED 1 MORE CANDLE?')}
              ${yn('emotionCheck','EMOTION CHECK PASS?')}
            </div>
            <div class="toolbar" style="grid-template-columns: 1fr; margin-top:10px;">
              <div class="field">
                <label>Checklist Grade</label>
                <div class="kpi-value ${s.grade==='A+'?'money-pos':(s.grade==='NO TRADE'?'money-neg':'')}" style="font-size:1.2rem;">${s.grade} (${s.yes}/${s.total})</div>
                <div style="margin-top:8px; padding:10px 12px; border:1px solid ${s.grade==='NO TRADE'?'rgba(239,68,68,.45)':(s.grade==='A+'?'rgba(34,197,94,.45)':'rgba(245,158,11,.45)')}; background:${s.grade==='NO TRADE'?'rgba(239,68,68,.12)':(s.grade==='A+'?'rgba(34,197,94,.12)':'rgba(245,158,11,.12)')}; color:${s.grade==='NO TRADE'?'#fecaca':(s.grade==='A+'?'#bbf7d0':'#fde68a')}; border-radius:10px; font-weight:700;">
                  ${s.grade==='NO TRADE' ? '‚õî NO TRADE ‚Äî conditions not met. Stand down and wait for A+ setup.' : (s.grade==='A+' ? '‚úÖ A+ ‚Äî Checklist conditions met. Execution allowed.' : '‚ö†Ô∏è B SETUP ‚Äî Reduce size or wait for cleaner confirmation.')}
                </div>
              </div>
            </div>
            <div class="field" style="margin-top:10px;"><label>Checklist Notes</label><textarea name="notes" rows="2">${d.notes||''}</textarea></div>
            <div style="display:flex; gap:8px; margin-top:10px; flex-wrap:wrap;"><button id="ck-save" class="btn" type="button">Save Checklist</button><button id="ck-reset" class="btn" type="button">Reset</button></div>
          </div>

          <div class="panel" style="margin-top:12px;">
            <h3 style="margin:0 0 10px;">Quick Trade Entry (same page)</h3>
            <div class="toolbar" style="grid-template-columns: minmax(0,.8fr) minmax(0,1.2fr);">
              <div class="field"><label>Date (auto)</label><input name="t_date" type="date" value="${autoDate}" /></div>
              <div class="field"><label>Entry Time (auto)</label><input name="t_time" type="time" value="${autoTime}" /></div>
              <div class="field"><label>Symbol</label><input name="t_symbol" placeholder="MNQH6" value="MNQH6" /></div>
              <div class="field"><label>Side</label><select name="t_side"><option ${d.direction==='Long'?'selected':''}>Long</option><option ${d.direction==='Short'?'selected':''}>Short</option></select></div>
              <div class="field"><label>Qty</label><input name="t_qty" type="number" step="1" value="1" /></div>
              <div class="field"><label>Commission</label><input name="t_comm" type="number" step="0.01" value="0" /></div>
              <div class="field"><label>Entry</label><input name="t_entry" type="number" step="0.01" /></div>
              <div class="field"><label>Exit</label><input name="t_exit" type="number" step="0.01" /></div>
              <div class="field"><label>P&L (gross)</label><input name="t_pnl" type="number" step="0.01" /></div>
              <div class="field"><label>R</label><input name="t_r" type="number" step="0.01" /></div>
            </div>
            <div class="field" style="margin-top:10px;"><label>Trade Notes</label><textarea name="t_notes" rows="2" placeholder="Execution notes"></textarea></div>
            <div style="display:flex; gap:8px; margin-top:10px; flex-wrap:wrap;">
              <button id="trade-save-inline" class="btn" type="button">Save Trade (with Checklist)</button>
            </div>
            <div id="trade-inline-msg" class="small muted" style="margin-top:8px;"></div>
          </div>`;

        root.querySelectorAll('input[name],select[name],textarea[name]').forEach(el=>{
          el.addEventListener('change', ()=>{ const n = Object.assign({}, load(), {[el.name]: el.value}); save(n); render(); });
        });
        root.querySelectorAll('.yn-btn').forEach(btn=>{
          btn.addEventListener('click', ()=>{
            const f = btn.dataset.field;
            const v = btn.dataset.val;
            const n = Object.assign({}, load(), {[f]: v});
            save(n);
            render();
          });
        });
        root.querySelector('#ck-save')?.addEventListener('click', ()=>{
          const n = Object.assign({}, load(), { date: root.querySelector('input[name="date"]').value || def.date, time: nowHHMM() });
          save(n);
          const ss = score(n);
          alert(`Checklist saved: ${ss.grade} (${ss.yes}/${ss.total}) at ${n.time}`);
          render();
        });

        root.querySelector('#trade-save-inline')?.addEventListener('click', ()=>{
          const n = Object.assign({}, load(), { date: root.querySelector('input[name="date"]').value || def.date, time: nowHHMM() });
          save(n);
          const ss = score(n);

          const val = (name) => root.querySelector(`[name="${name}"]`)?.value || '';
          const num = (name, dflt=0) => {
            const v = Number(val(name));
            return Number.isFinite(v) ? v : dflt;
          };

          const t = {
            id: `MAN-${Date.now()}`,
            date: val('t_date') || n.date || def.date,
            entryTime: val('t_time') || n.time || nowHHMM(),
            assetType: 'futures',
            symbol: (val('t_symbol') || 'MNQH6').toUpperCase(),
            underlying: 'NQ',
            side: val('t_side') || n.direction || 'Long',
            setup: `Checklist ${ss.grade}`,
            strategy: 'Pre-Trade Checklist',
            qty: num('t_qty',1),
            entry: num('t_entry',0),
            exit: num('t_exit',0),
            pnl: num('t_pnl',0),
            commission: num('t_comm',0),
            r: num('t_r',0),
            tags: ['checklist', `grade:${ss.grade}`],
            notes: `${val('t_notes')} | Checklist ${ss.grade} (${ss.yes}/${ss.total}) | mtf:${n.mtfAligned||'-'} bias:${n.biasAligned||'-'} A+:${n.aPlusWindow||'-'} BOS:${n.bosConfirmed||'-'} ORB:${n.orbCondition||'-'} path:${n.clearPath||'-'} wait1m:${n.waitOneMin||'-'} emotion:${n.emotionCheck||'-'}${n.notes?` | ${n.notes}`:''}`,
            checklistGrade: ss.grade,
            checklistScore: `${ss.yes}/${ss.total}`,
            checklistCriticalOk: ['mtfAligned','biasAligned','aPlusWindow','emotionCheck'].every(f=>String(n[f]||'').toLowerCase()==='yes'),
            checklistSnapshot: n,
            status: 'closed'
          };

          try {
            const key='mvp_manual_trades_v2';
            const arr = JSON.parse(localStorage.getItem(key) || '[]');
            arr.unshift(t);
            localStorage.setItem(key, JSON.stringify(arr));
            const msg = root.querySelector('#trade-inline-msg');
            if (msg) msg.textContent = `Saved trade ${t.id} (${t.side}) with checklist ${ss.grade}.`;
          } catch (e) {
            const msg = root.querySelector('#trade-inline-msg');
            if (msg) msg.textContent = `Save failed: ${String((e&&e.message)||e)}`;
          }
        });

        root.querySelector('#ck-reset')?.addEventListener('click', ()=>{ save(def); render(); });
      }
      render();
    })();
  </script>
</body>
</html>
