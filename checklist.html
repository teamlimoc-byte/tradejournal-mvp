<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trading Platform MVP â€” Pre-Trade Checklist</title>
  <link rel="stylesheet" href="./assets/styles.css?v=20260227j" />
</head>
<body class="checklist-page">
  <header class="topbar">
    <div class="container">
      <div class="brand">Trade<span>Journal</span> MVP</div>
      <nav class="nav">
        <a class="nav-link" href="index.html">Combined</a>
        <a class="nav-link" href="dashboard-futures.html">Futures</a>
        <a class="nav-link" href="dashboard-options.html">Options</a>
        <a class="nav-link" href="checklist.html">Checklist</a>
        <a class="nav-link" href="trades.html">Trades</a>
        <a class="nav-link" href="journal.html">Journal</a>
        <a class="nav-link" href="reports.html">Reports</a>
        <button id="theme-toggle" class="btn" type="button" style="padding:7px 10px;">ðŸŒ™</button>
      </nav>
    </div>
  </header>

  <main class="container">
    <h1 class="page-title">Pre-Trade Checklist</h1>
    <div class="subtle">Run this before entry. Score and grade are saved into new trade records automatically.</div>
    <section id="checklist-root" style="margin-top:12px;"></section>
  </main>

  <footer>Static/offline-friendly build for GitHub Pages</footer>
  <script src="./assets/app.js?v=20260227y"></script>
  <script>
    (function(){
      const key = 'mvp_pretrade_checklist_v1';
      const root = document.getElementById('checklist-root');
      if (!root) return;
      if (root.innerHTML && root.innerHTML.trim().length) return;

      const def = {
        date: new Date().toISOString().slice(0,10), time:'', direction:'Long',
        mtfAligned:'', biasAligned:'', aPlusWindow:'', bosConfirmed:'', orbCondition:'',
        ema10mRule:'', notDeadzone:'', emotionCheck:'', notes:''
      };
      const load = () => { try { return Object.assign({}, def, JSON.parse(localStorage.getItem(key)||'{}')); } catch { return Object.assign({}, def); } };
      const save = (d) => localStorage.setItem(key, JSON.stringify(d));
      const score = (d) => {
        const fields = ['mtfAligned','biasAligned','aPlusWindow','bosConfirmed','orbCondition','ema10mRule','notDeadzone','emotionCheck'];
        const yes = fields.filter(f => String(d[f]).toLowerCase()==='yes').length;
        const critical = ['mtfAligned','biasAligned','aPlusWindow','emotionCheck'];
        const criticalOk = critical.every(f => String(d[f]).toLowerCase()==='yes');
        const grade = (criticalOk && yes>=7) ? 'A+' : (criticalOk && yes>=5) ? 'B' : 'NO TRADE';
        return {yes,total:fields.length,grade};
      };

      function nowHHMM(){ const n = new Date(); return String(n.getHours()).padStart(2,'0') + ':' + String(n.getMinutes()).padStart(2,'0'); }
      function render(){
        const d = load();
        const s = score(d);
        const yn = (name,label) => {
          const yesOn = d[name] === 'yes';
          const noOn = d[name] === 'no';
          return `<div class="field"><label>${label}</label><div style="display:flex; gap:8px; margin-top:6px;"><button type="button" class="btn yn-btn yn-yes ${yesOn?'active':''}" data-field="${name}" data-val="yes">${yesOn?'âœ“ ':''}Yes</button><button type="button" class="btn yn-btn yn-no ${noOn?'active':''}" data-field="${name}" data-val="no">${noOn?'âœ“ ':''}No</button></div></div>`;
        };
        root.innerHTML = `
          <div class="panel">
            <div class="toolbar" style="grid-template-columns: repeat(2,minmax(0,1fr));">
              <div class="field"><label>Date</label><input type="date" name="date" value="${d.date||''}" /></div>
              <div class="field"><label>Direction</label><select name="direction"><option ${d.direction==='Long'?'selected':''}>Long</option><option ${d.direction==='Short'?'selected':''}>Short</option></select></div>
            </div>
            <div class="toolbar" style="grid-template-columns: repeat(2,minmax(0,1fr)); margin-top:10px;">
              ${yn('mtfAligned','3/4+ MTF aligned with direction?')}
              ${yn('biasAligned','Bias matches direction?')}
              ${yn('aPlusWindow','A+ window?')}
              ${yn('bosConfirmed','BOS confirmation present?')}
              ${yn('orbCondition','ORB condition met?')}
              ${yn('ema10mRule','10m 8EMA rule satisfied?')}
              ${yn('notDeadzone','Not deadzone?')}
              ${yn('emotionCheck','Emotion check passed (no FOMO/revenge)?')}
            </div>
            <div class="toolbar" style="grid-template-columns: 1fr; margin-top:10px;">
              <div class="field"><label>Checklist Grade</label><div class="kpi-value ${s.grade==='A+'?'money-pos':(s.grade==='NO TRADE'?'money-neg':'')}" style="font-size:1.2rem;">${s.grade} (${s.yes}/${s.total})</div></div>
            </div>
            <div class="field" style="margin-top:10px;"><label>Notes</label><textarea name="notes" rows="2">${d.notes||''}</textarea></div>
            <div style="display:flex; gap:8px; margin-top:10px; flex-wrap:wrap;"><button id="ck-save" class="btn" type="button">Save Checklist</button><button id="ck-use" class="btn" type="button">Use in Trade Form</button><button id="ck-reset" class="btn" type="button">Reset</button></div>
          </div>`;

        root.querySelectorAll('input[name],select[name],textarea[name]').forEach(el=>{
          el.addEventListener('change', ()=>{ const n = Object.assign({}, load(), {[el.name]: el.value}); save(n); render(); });
        });
        root.querySelectorAll('.yn-btn').forEach(btn=>{
          btn.addEventListener('click', ()=>{
            const f = btn.dataset.field;
            const v = btn.dataset.val;
            const n = Object.assign({}, load(), {[f]: v});
            save(n);
            render();
          });
        });
        root.querySelector('#ck-save')?.addEventListener('click', ()=>{
          const n = Object.assign({}, load(), { time: nowHHMM() }); // auto-log current time on save
          save(n);
          const ss = score(n);
          alert(`Checklist saved: ${ss.grade} (${ss.yes}/${ss.total}) at ${n.time}`);
          render();
        });
        root.querySelector('#ck-use')?.addEventListener('click', ()=>{
          const n = Object.assign({}, load(), { time: nowHHMM() });
          save(n);
          const ss = score(n);
          const draft = {
            assetType: 'futures',
            side: n.direction || 'Long',
            setup: `Checklist ${ss.grade}`,
            strategy: 'Pre-Trade Checklist',
            notes: `Checklist ${ss.grade} (${ss.yes}/${ss.total}) | mtf:${n.mtfAligned||'-'} bias:${n.biasAligned||'-'} A+win:${n.aPlusWindow||'-'} BOS:${n.bosConfirmed||'-'} ORB:${n.orbCondition||'-'} 10mEMA:${n.ema10mRule||'-'} deadzone:${n.notDeadzone||'-'} emotion:${n.emotionCheck||'-'}${n.notes?` | ${n.notes}`:''}`
          };
          localStorage.setItem('mvp_trade_draft_v1', JSON.stringify(draft));
          window.location.href = `./trades.html?from=checklist&side=${encodeURIComponent((n.direction||'Long').toLowerCase())}`;
        });
        root.querySelector('#ck-reset')?.addEventListener('click', ()=>{ save(def); render(); });
      }
      render();
    })();
  </script>
</body>
</html>
